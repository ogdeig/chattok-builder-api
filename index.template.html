<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>{{TITLE}}</title>

  <!-- Base-href fix for about:srcdoc contexts -->
  <script>
    (function () {
      try {
        var isAbout = (location && String(location.protocol).toLowerCase() === "about:");
        var baseURI = (document && document.baseURI ? String(document.baseURI) : "");
        if (!isAbout && !/^about:/i.test(baseURI)) return;
        if (document.querySelector("base")) return;
        var ref = document.referrer;
        if (!ref && window.parent && window.parent.location) ref = window.parent.location.href;
        if (!ref) return;
        var u = new URL(ref);
        var dir = u.origin + u.pathname.replace(/[^\/]*$/, "");
        var base = document.createElement("base");
        base.href = dir;
        document.head.appendChild(base);
      } catch (e) {}
    })();
  </script>

  <link rel="stylesheet" href="style.css" />
  <style>
    /* Ensure overlay input is always interactable in iframes */
    #setupOverlay { z-index: 10; }
    .overlay-card input { font-size: 16px; } /* iOS focus zoom prevention */
  </style>
</head>

<body>
  <div id="app">
    <div id="gameScreen" class="game-screen">
      <!-- CONNECT-FIRST overlay -->
      <div id="setupOverlay" class="overlay" aria-live="polite">
        <div class="overlay-card">
          <div class="title">{{TITLE}}</div>
          <div class="subtitle">{{ONE_SENTENCE}}</div>

          <div class="hint" style="margin-top:10px">
            <div class="hint-title">How to play</div>
            <div class="hint-sub">{{SUBTITLE}}</div>
            <ul class="hint-list">
              {{HOW_TO_PLAY_LI}}
            </ul>
          </div>

          <div class="row" style="margin-top:12px">
            <label class="label" for="liveIdInput">TikTok LIVE ID (Host)</label>
            <input id="liveIdInput"
                   class="input"
                   placeholder="Example: huntbreaks"
                   inputmode="text"
                   autocomplete="off"
                   autocapitalize="none"
                   spellcheck="false"
                   tabindex="0" />
          </div>

          <button id="startGameBtn" class="btn primary" style="margin-top:12px" tabindex="0">Start</button>

          <div class="status" style="margin-top:10px">
            <span class="dot"></span>
            <span id="statusText">Enter your LIVE ID, then press Start.</span>
          </div>

          <div class="muted" style="margin-top:10px; font-size:12px; line-height:1.35">
            Note: TikTok connection is provided by ChatTokGaming during preview/live.
          </div>
        </div>
      </div>

      <!-- Game canvas + HUD (built/used by game.js) -->
      <div id="gameRoot" class="root">
        <canvas id="gameCanvas" width="720" height="1280" aria-label="game-canvas"></canvas>

        <div class="hud">
          <div class="hud-left">
            <div class="pill">
              <span class="k">Status</span>
              <span class="v" id="statusTextInGame">Offline</span>
            </div>
            <div class="pill">
              <span class="k">Mode</span>
              <span class="v">{{MODE_BADGE}}</span>
            </div>
          </div>

          <div class="hud-right" id="hudRight"></div>
        </div>

        <div id="flags" class="flags"></div>
      </div>
    </div>
  </div>

  <!-- We no longer auto-fetch proto or tiktok-client here.
       ChatTokGaming injects them; we simply wait for TikTokClient in game.js on Start. -->
  <script src="game.js"></script>
</body>
</html>
