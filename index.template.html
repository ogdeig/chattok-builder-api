<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>{{TITLE}}</title>

  <!--
    IMPORTANT:
    When this HTML runs inside iframe srcdoc (about:srcdoc), relative paths can resolve
    to site root (/) due to parent app base href="/".
    We force a local <base> using document.referrer (the parent page URL).
  -->
  <script>
    (function () {
      try {
        var ref = document.referrer;
        if (!ref && window.parent && window.parent.location) ref = window.parent.location.href;
        if (!ref) return;

        var u = new URL(ref);
        var dir = u.origin + u.pathname.replace(/[^\/]*$/, "");

        var base = document.createElement("base");
        base.href = dir;
        document.head.appendChild(base);
      } catch {}
    })();
  </script>

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="app">
    <div id="gameScreen" class="game-screen">
      <!-- CONNECT-FIRST overlay -->
      <div id="setupOverlay" class="overlay">
        <div class="overlay-card">
          <div class="title">{{TITLE}}</div>
          <div class="subtitle">{{ONE_SENTENCE}}</div>

          <div class="hint" style="margin-top:10px">
            <div class="hint-title">How to play</div>
            <div class="hint-sub">{{SUBTITLE}}</div>
            <ul class="hint-list">
              {{HOW_TO_PLAY_LI}}
            </ul>
            <div class="hint-sub muted">
              Tip: Once connected, chat/likes/gifts will instantly affect the action on screen.
            </div>
          </div>

          <div class="form-grid" style="margin-top:12px">
            <label class="field">
              <span class="field-label">TikTok LIVE ID</span>
              <input id="liveIdInput" type="text" placeholder="Example: huntbreaks" autocomplete="off" />
            </label>

            <!-- Injected by server (Round seconds + Win goal) -->
            {{SETTINGS_FIELDS_HTML}}

            <button id="startGameBtn" class="primary-btn" type="button">
              Start & Connect
            </button>

            <div class="status-line">
              <span id="statusText">Enter your LIVE ID, then press Start.</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Main game UI -->
      <div class="game-wrapper">
        <div class="topbar">
          <div>
            <div class="game-name">{{TITLE}}</div>
            <div class="game-sub">{{SUBTITLE}}</div>
          </div>

          <div class="pill">
            <span class="status-text" id="statusTextInGame">Ready</span>
          </div>
        </div>

        <div class="layout">
          <div class="main">
            <div class="viewport">
              <div class="safe-top"></div>

              <!-- game.js renders here -->
              <div id="gameRoot" class="game-root"></div>

              <div class="safe-bottom"></div>
            </div>
          </div>

          <!-- Flags (pop-out toasts). No scroll boxes. Transparent + small. -->
          <div class="side">
            <div class="side-card">
              <div id="flags" class="flags"></div>
            </div>
          </div>
        </div>

        <div class="footer-text">
          Powered by ChatTok â€¢ Live interactions drive the action
        </div>
      </div>
    </div>
  </div>

  <!-- TikTok client stack -->
  <script src="proto.bundle.js"></script>
  <script src="tiktok-client.js"></script>
  <script src="game.js"></script>
</body>
</html>
