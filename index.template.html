<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>{{TITLE}}</title>

  <meta name="theme-color" content="{{THEME_BACKGROUND}}" />

  <link rel="stylesheet" href="style.css" />

  <style>
    html,body{height:100%;margin:0;background:#050b17;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    #bootError{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:24px;background:#050b17;z-index:9999}
    #bootError .card{max-width:720px;width:100%;border-radius:16px;padding:18px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12)}
    #bootError code{background:rgba(0,0,0,.35);padding:2px 6px;border-radius:8px}
  </style>
</head>

<body>
  <div id="bootError">
    <div class="card">
      <div style="font-size:18px;font-weight:800;margin-bottom:8px">This game can’t start yet</div>
      <div id="bootErrorText" style="opacity:.85;line-height:1.35"></div>
      <div style="margin-top:12px;opacity:.75;font-size:13px">
        If you’re testing locally, make sure the TikTok client scripts are present, or run it on ChatTok Gaming where they’re injected automatically.
      </div>
    </div>
  </div>

  <div id="app" class="app">
    <aside class="panel left">
      <div class="panelHeader">
        <div class="brand">
          <div class="dot"></div>
          <div class="brandText">
            <div class="brandTitle">{{TITLE}}</div>
            <div class="brandSub">{{SUBTITLE}}</div>
          </div>
        </div>
      </div>

      <div class="panelBody">
        <div class="kicker">{{ONE_SENTENCE}}</div>

        <div class="card">
          <div class="cardTitle">Setup</div>

          <label class="field">
            <span class="fieldLabel">TikTok LIVE username or room ID</span>
            <input id="liveIdInput" class="input" autocomplete="off" placeholder="e.g., huntbreaks" />
          </label>

          <div class="row">
            <button id="startGameBtn" class="btn primary">Start</button>
            <button id="practiceBtn" class="btn">Practice</button>
          </div>

          <div id="statusText" class="status">Ready.</div>
        </div>

        <div class="card">
          <div class="cardTitle">How to Play</div>
          <ul class="howList">
            {{HOW_TO_PLAY_LI}}
          </ul>
        </div>

        <div class="card">
          <div class="cardTitle">Host Tips</div>
          <div class="small">
            • Pin a message showing the commands.<br/>
            • Encourage quick repeats: “A4, B7, J2…”<br/>
            • Likes and gifts trigger bonus effects (shown on-screen).
          </div>
        </div>
      </div>
    </aside>

    <main class="panel center">
      <div class="topBar">
        <div class="pill" id="gameTitlePill">{{TITLE}}</div>
        <div class="pill subtle" id="statusTextInGame">Not connected</div>
      </div>

      <div id="gameRoot" class="gameRoot">
        <canvas id="gameCanvas" width="720" height="1280"></canvas>

        <div id="flashLayer" class="flashLayer" aria-hidden="true"></div>

        <div class="hud">
          <div class="hudBlock">
            <div class="hudLabel">Round</div>
            <div class="hudValue" id="hudRound">1</div>
          </div>
          <div class="hudBlock">
            <div class="hudLabel">Time</div>
            <div class="hudValue" id="hudTime">—</div>
          </div>
          <div class="hudBlock">
            <div class="hudLabel">Shots</div>
            <div class="hudValue" id="hudShots">0</div>
          </div>
          <div class="hudBlock">
            <div class="hudLabel">Hits</div>
            <div class="hudValue" id="hudHits">0</div>
          </div>
        </div>

        <div id="scoreboard" class="scoreboard"></div>
        <div id="flags" class="flags"></div>
      </div>

      <div id="setupOverlay" class="overlay">
        <div class="overlayCard">
          <div class="overlayTitle">{{TITLE}}</div>
          <div class="overlaySub">{{ONE_SENTENCE}}</div>
          <div class="overlayActions">
            <button id="overlayStartBtn" class="btn primary">Start</button>
            <button id="overlayPracticeBtn" class="btn">Practice</button>
          </div>
          <div class="overlayHint">Tip: you can still practice by tapping the grid if TikTok isn’t connected.</div>
        </div>
      </div>
    </main>
  </div>

  <script>
    (function(){
      try{
        if(location && location.protocol === "about:"){
          const ref = document.referrer || "";
          if(ref){
            const base = document.createElement("base");
            base.href = ref.replace(/[#?].*$/,"").replace(/\/[^\/]*$/,"/");
            document.head.appendChild(base);
          }
        }
      }catch(e){}
    })();
  </script>

  <script src="game.js"></script>
</body>
</html>
