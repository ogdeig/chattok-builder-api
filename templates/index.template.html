<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>{{TITLE}}</title>

  <!--
    IMPORTANT:
    When this HTML runs inside iframe srcdoc (about:srcdoc), relative paths can resolve
    to the parent app base (/) depending on how the preview runner is hosted.
    We force a local <base> using document.referrer (the parent page URL directory)
    so that style.css and game.js resolve correctly.
  -->
  <script>
    (function () {
      try {
        var ref = document.referrer;
        if (!ref && window.parent && window.parent.location) ref = window.parent.location.href;
        if (!ref) return;

        var u = new URL(ref);
        var dir = u.origin + u.pathname.replace(/[^\/]*$/, "");

        var base = document.createElement("base");
        base.href = dir;
        document.head.appendChild(base);
      } catch {}
    })();
  </script>

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="app">
    <div id="gameScreen" class="game-screen">

      <!-- CONNECT / SETTINGS OVERLAY -->
      <div id="setupOverlay" class="overlay">
        <div class="overlay-card">
          <div class="title">{{TITLE}}</div>
          <div class="subtitle">{{ONE_SENTENCE}}</div>

          <div class="hint" style="margin-top:10px">
            <div class="hint-title">What will happen</div>
            <div class="hint-sub">{{SUBTITLE}}</div>
            <ul class="hint-list">
              {{HOW_TO_PLAY_LI}}
            </ul>
            <div class="hint-sub muted" style="margin-top:8px">
              If TikTok connection libraries are injected by ChatTokGaming, the game will connect.
              If you’re viewing elsewhere, the game still runs in offline demo mode (no blank screen).
            </div>
          </div>

          <div class="form-grid" style="margin-top:12px">
            <label class="field">
              <span class="field-label">TikTok LIVE ID</span>
              <input id="liveIdInput" type="text" placeholder="Example: huntbreaks" autocomplete="off" />
            </label>

            <!-- Settings grid read by game.js -->
            <div id="settingsGrid" class="settings-grid">
              <!-- Common command settings (safe defaults; game can ignore if not needed) -->
              <label class="field">
                <span class="field-label">Join Command</span>
                <input id="joinCommand" data-setting-key="joinCommand" type="text" value="!join" autocomplete="off" />
                <span class="field-hint">Chat “!join” adds a player (offline-safe).</span>
              </label>

              <label class="field">
                <span class="field-label">Action Command</span>
                <input id="actionCommand" data-setting-key="actionCommand" type="text" value="!boost" autocomplete="off" />
                <span class="field-hint">Chat “!boost” triggers a small power effect.</span>
              </label>

              <label class="field checkbox-row">
                <input id="allowShareForAction" data-setting-key="allowShareForAction" type="checkbox" />
                <span class="field-label-inline">Allow SHARE to count as Action</span>
              </label>

              <!-- Injected by server (additional settings as needed) -->
              {{SETTINGS_FIELDS_HTML}}
            </div>

            <button id="startGameBtn" class="primary-btn" type="button">
              Start & Connect
            </button>

            <div class="status-line">
              <span id="statusText">Enter your LIVE ID, then press Start.</span>
            </div>
          </div>
        </div>
      </div>

      <!-- MAIN GAME UI -->
      <div class="game-wrapper">
        <div class="topbar">
          <div>
            <div class="game-name">{{TITLE}}</div>
            <div class="game-sub">{{SUBTITLE}}</div>
          </div>
          <div class="pill">
            <span class="status-text" id="statusTextInGame">Disconnected</span>
          </div>
        </div>

        <div class="layout">
          <div class="main">
            <div class="viewport">
              <div class="safe-top"></div>

              <!-- game root + canvas required by game.template.js -->
              <div id="gameRoot" class="game-root">
                <canvas id="gameCanvas" aria-label="Game Canvas"></canvas>

                <!-- center toast overlay -->
                <div id="centerToast" class="center-toast" aria-live="polite"></div>
              </div>

              <div class="safe-bottom"></div>
            </div>
          </div>

          <!-- Notifications area (game.js can hide if not used) -->
          <div class="side">
            <div class="side-card">
              <div id="flags" class="flags"></div>
            </div>
          </div>
        </div>

        <div class="footer-text">
          Powered by ChatTok • Live interactions drive the action
        </div>
      </div>

    </div>
  </div>

  <!--
    IMPORTANT CONTRACT:
    - Do NOT load proto.bundle.js here.
    - Do NOT load tiktok-client.js here.
    ChatTokGaming preview/live injects those platform libs when applicable.
    This template always loads game.js; game.js will connect if TikTokClient + proto exist.
  -->
  <script src="game.js"></script>
</body>
</html>
